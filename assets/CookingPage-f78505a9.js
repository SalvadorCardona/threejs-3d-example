import{u as L,k as R,T as A,r as o,V as f,e as X,a as C,M as Q,b as P,E as Z,j as s,R as V,l as Y,Q as _,m as N,C as q,i as J,O as $,h as ee}from"./index-8eb87818.js";import{u as I,a as te,b as se,B as re,H as ne,K as oe}from"./SplineGameStore-501aa676.js";const B=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function O(e,t){const r=L(a=>a.gl),n=R(A,B(e)?Object.values(e):e);if(o.useLayoutEffect(()=>{t==null||t(n)},[t]),o.useEffect(()=>{(Array.isArray(n)?n:[n]).forEach(r.initTexture)},[r,n]),B(e)){const a=Object.keys(e),c={};return a.forEach(u=>Object.assign(c,{[u]:n[a.indexOf(u)]})),c}else return n}O.preload=e=>R.preload(A,e);O.clear=e=>R.clear(A,e);const ae="https://salvadorcardona.github.io/threejs-3d-example/assets/cooking-af6e5aea.glb";function W(){return{objects:{},add:function(e,t){this.has(e)||(this.objects[e]=[]),this.objects[e].push(t)},has:function(e){return Object.hasOwn(this.objects,e)},get:function(e){return this.has(e)?this.objects[e][0]:null},getAbsolutePosition:function(e){const t=this.get(e);return t&&new f().setFromMatrixPosition(t.matrixWorld)},getAll:function(e){return this.has(e)?this.objects[e]:null}}}function ce(e){const t=W();return e.traverse(r=>{var n;if(r.name.includes("#")){const a=/#[a-zA-Z0-9_]+/g;(n=r.name)==null||n.match(a).forEach(c=>{t.add(c,r)})}}),t}const T=X(e=>({selectors:W()})),ie=200,v=new f,z=new f,G=new f;function le(){const e=I(),t=T(),{scene:r}=L(),n=C(Q.CHARACTER),a=t.selectors.getAbsolutePosition("#table");n.scene.traverse(h=>{h.castShadow=!0,h.receiveShadow=!0});const{actions:c}=te(n.animations,r),u=o.useRef(null),[,b]=se(),[i,k]=o.useState(null);return o.useEffect(()=>{u.current&&(e.player=u.current)},[]),P(h=>{var D;const{forward:j,backward:l,left:m,right:g}=b(),p=u.current,S=p.linvel(),y=new _,x=p.translation();if(z.set(0,0,l-j),G.set(m-g,0,0),v.subVectors(z,G).normalize().multiplyScalar(ie).applyEuler(h.camera.rotation),p.setLinvel({x:v.x,y:S.y,z:v.z},!0),[j,l,m,g].includes(!0)){let d=Math.PI;j&&(d*=.5),m&&(d*=1),l&&(d*=1.5),g&&(d*=2),y.setFromEuler(new Z(0,d,0)),e.move(),p.setRotation(y,!0),Object.values(c).forEach(w=>{w==null||w.play()}),i&&a.distanceTo(x)<50&&(e.foodGiven(i),k(null)),(D=t.selectors.getAll("#drink"))==null||D.forEach(w=>{const F=new f;if(F.setFromMatrixPosition(w.matrixWorld),F.distanceTo(x)<50){const M=w.clone(),U=new f(0,x.y,0);M.position.copy(U),k(M)}})}else Object.values(c).forEach(d=>{d==null||d.stop()})}),s.jsx(s.Fragment,{children:s.jsx(V,{ref:u,position:[0,10,0],enabledRotations:[!1,!1,!1],canSleep:!1,colliders:!1,mass:1e5,children:s.jsxs(Y,{args:[1,20],children:[i&&s.jsx("primitive",{castShadow:!0,object:i}),s.jsx("primitive",{castShadow:!0,object:n.scene,scale:10})]})})})}const H="https://salvadorcardona.github.io/threejs-3d-example/assets/client-1243521c.glb";function K(e){return{currentClient:!1,position:new f,hasDrink:!1,drunk:null,clientNumber:0,ref:o.createRef(),...e}}const E={clientNumber:5,distanceBetweenClient:50};function ue(){const e=[];for(let t=0;t<E.clientNumber;t++){const r=t===0,n=new f(205+E.distanceBetweenClient*t,.99,157),c=K({currentClient:r,position:n,clientNumber:t});e.push(c)}return e}function fe(e){const t=e.pop(),r=t==null?void 0:t.position.clone();return r==null||r.setX((r==null?void 0:r.x)+E.distanceBetweenClient),K({clientNumber:(t==null?void 0:t.clientNumber)+1,position:r})}function de(){const e=T(),t=I(),[r,n]=o.useState(!1);C(H).scene,e.selectors.getAbsolutePosition("#generator");const c=e.selectors.getAbsolutePosition("#stopclient");e.selectors.getAll("#drink");const[u,b]=o.useState(null),[i,k]=o.useState(ue()),[h,j]=o.useState(i[0]);return P(()=>{var m;if(!r){n(!0);return}((m=h.ref)==null?void 0:m.current).position.x>c.x&&i.forEach(g=>{var S,y,x;if(!((S=g.ref)!=null&&S.current))return;const p=(x=(y=g.ref)==null?void 0:y.current)==null?void 0:x.position;p.setX(p.x-1)})}),t.onFoodGiven(l=>{b(l),h.drunk=l;const m=i[h.clientNumber+1];j(m),k([...i,fe(i)])}),s.jsx(s.Fragment,{children:i.map(l=>o.createElement(he,{...l,ref:l.ref,key:l.clientNumber}))})}const he=o.forwardRef((e,t)=>{const r=C(H),[n,a]=o.useState(!1),[c,u]=o.useState(new f);o.useEffect(()=>{u(new f(0,50,0)),a(!0)});const b=o.createRef();return s.jsxs("group",{position:e.position,ref:t,children:[e.drunk&&s.jsx("primitive",{castShadow:!0,object:e.drunk}),s.jsx("primitive",{ref:b,castShadow:!0,object:r.scene.clone(),scale:20,rotation:[0,-Math.PI/2,0]}),n&&s.jsx(re,{follow:!0,lockX:!1,lockY:!1,lockZ:!1,position:c,children:s.jsx(ne,{occlude:!0,style:{padding:10,background:"rgba(255,255,255,0.5)"},children:s.jsx("p",{children:"Cofee"})})})]})}),me="https://salvadorcardona.github.io/threejs-3d-example/assets/sea-texture-e862990a.jpg";function pe(){const e=o.useRef(null),t=O(me);return t.repeat.set(10,10),t.wrapS=N,t.wrapT=N,P(r=>{if(!e.current)return;const a=Math.cos(r.clock.elapsedTime)*.001;t.offset.x+=a,t.offset.y+=a}),s.jsxs("mesh",{ref:e,position:[0,-40,0],rotation:[-Math.PI/2,0,0],children:[s.jsx("planeGeometry",{args:[4e3,4e3,40,40]}),s.jsx("meshBasicMaterial",{map:t})]})}function we(){const e=C(ae),t=T();return e.scene.traverse(r=>{r.castShadow=!0,r.receiveShadow=!0}),t.selectors=ce(e.scene),s.jsx(s.Fragment,{children:s.jsx(oe,{map:[{name:"forward",keys:["ArrowUp","w","W"]},{name:"backward",keys:["ArrowDown","s","S"]},{name:"left",keys:["ArrowLeft","a","A"]},{name:"right",keys:["ArrowRight","d","D"]},{name:"jump",keys:["Space"]},{name:"enter",keys:["e","enter"]}],children:s.jsxs(q,{shadows:!0,flat:!0,linear:!0,children:[s.jsx("color",{attach:"background",args:["skyblue"]}),s.jsx(pe,{}),s.jsx("directionalLight",{name:"Directional Light",castShadow:!0,intensity:1.2,color:"white","shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-near":-1e4,"shadow-camera-far":1e5,"shadow-camera-left":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-bottom":-1e3,position:[-25,50,25]}),s.jsx(J,{name:"1",makeDefault:!0,zoom:2,far:1e5,near:-1e5,position:[-444.64,1022.11,323.49],rotation:[-1.2,-.31,-.67],scale:1}),s.jsx($,{makeDefault:!0}),s.jsx("ambientLight",{intensity:.7,color:"#white"}),s.jsxs(ee,{gravity:[0,-100,0],children:[s.jsx(le,{}),s.jsx(V,{type:"fixed",restitution:0,friction:0,children:s.jsx("primitive",{object:e.scene,castShadow:!0,receiveShadow:!0,scale:50})}),s.jsx(de,{})]})]})})})}export{we as CookingPage};
